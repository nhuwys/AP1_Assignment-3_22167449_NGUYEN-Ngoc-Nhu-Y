---
title: "Assignment 3"
author: "NGUYEN Ngoc Nhu Y"
output: pdf_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      comment = "",
                      message = FALSE,
                      warning = FALSE)
```

# Task 1

```{r}
#Read the dataset and replace "?" with NA
engine <- read.csv("Engine.csv", na.strings = "?")
automobile <- read.csv("Automobile.csv", na.strings = "?")
maintenance <- read.csv("Maintenance.csv", na.strings = "?")
```

```{r}
#Inspect the structure of the dataset "Engine.csv"
str(engine)
#Inspect the structure of the dataset "Automobile.csv"
str(automobile)
#Inspect the structure of the dataset "Maintenance.csv"
str(maintenance)
```

```{r}
#Count total missing values after replacing "?" with NA
cat("Missing values in Engine:", sum(is.na(engine)), "\n")
cat("Missing values in Automobile:", sum(is.na(automobile)), "\n")
cat("Missing values in Maintenance:", sum(is.na(maintenance)), "\n")
```

```{r}
# Check which columns contain NA in the Engine dataset
colSums(is.na(engine))
# Count number of rows in Engine affected by missing values
rows_with_na <- sum(rowSums(is.na(engine)) > 0)
cat("Rows with missing values in Engine:", rows_with_na, "\n")
```

## **Notes:**

Only Engine has missing values "?" (Engine = 6, Automobile & Maintenance
= 0).

-\> only Engine has affected rows (Missing values occur only in
Horsepower)

-\> only Engine needs cleaning

When inspecting the column, it is appeared that there are:

-   5 missing entries occur in EngineType

-   1 missing entry occurs in Horsepower

**Replacing "?" with NA does not change the distribution because no
actual values are modified; NA only marks missing entries.**

```{r}
#Convert categorical variables to factors
automobile$BodyStyles <- as.factor(automobile$BodyStyles)
engine$FuelTypes <- as.factor(engine$FuelTypes)
maintenance$ErrorCodes <- as.factor(maintenance$ErrorCodes)

#Compute the median Horsepower for imputation
median_hp <- median(engine$Horsepower, na.rm = TRUE)

#Replace the missing Horsepower values with median
engine$Horsepower[is.na(engine$Horsepower)] <- median_hp
```

Horsepower is a numerical variable

-\> use median -\> resistant to outliers and preserves the central
tendency

**Note on EngineType missing values:** EngineType is categorical;
missing entries were retained as NA and it is only required to replace
missing Horsepower values.

## Distribution of Horsepower Across Engine Types

```{r}
# Distribution of Horsepower Across Engine Types
library(ggplot2)

#Visualize Horsepower distribution
ggplot(engine, aes(x = Horsepower)) +
  geom_histogram(binwidth = 10, fill = "skyblue", color = "black") +
  labs(title = "Distribution of Horsepower", 
       x = "Horsepower", 
       y = "Count")
```

The histogram indicates a strongly right-skewed distribution. The
majority of Horsepower values are concentrated between 50 and 170,
suggesting that most engines in the dataset belong to small to mid-sized
vehicles. However, the long right tail indicates several high-horsepower
engines, which act as outliers.

Since the missing values were replaced with the median horsepower, the
distribution remains stable and does not shift. This is expected because
the median is robust to extreme values and represents the central
tendency of the dataset.

############################################################### 

# Task 2

## Horsepower Distribution Across Engine Types

```{r}
# Distribution of Horsepower Across Engine Types
library(ggplot2)

# Histogram of Horsepower for each engine type
ggplot(engine, aes(x = Horsepower, fill = EngineType)) +
  geom_histogram(binwidth = 10, alpha = 0.6, color = "black") +
  facet_wrap(~EngineType, scales="free_y") +
  labs(title = "Horsepower Distribution Across Engine Types",
       x = "Horsepower",
       y = "Count",
       fill = "Engine Types")
```

The distribution of horsepower varies noticeably across different engine
types. OHC engines appear most frequently in the dataset and generally
fall within the low- to mid-range horsepower levels, indicating that
they are typically used in standard consumer vehicles. In contrast, DOHC
and OHCV engines display a wider spread and extend into higher
horsepower ranges, suggesting that these engine types are associated
with stronger performance capabilities. Rotor engines are rare and
exhibit a very narrow horsepower distribution, highlighting their
limited use in this dataset.

=\> The engine type is closely related to the achievable horsepower,
with more advanced configurations tending to produce greater power.

## Horsepower Distribution Across Engine Size Groups

```{r}
# Create Engine Size Groups
engine$SizeGroup <- cut(engine$EngineSize,
  breaks = c(60, 90, 190, 299, Inf),
  labels = c("60-90", "91-190", "191-299", "300+"))

#Create table for Engine Size Groups
table (engine$SizeGroup)

#Facet_wrap Histogram of Horsepower by Size Groups
ggplot(engine, aes(x = Horsepower, fill = SizeGroup)) +
  geom_histogram(binwidth = 10, alpha = 0.6, color = "black") +
  facet_wrap(~ SizeGroup, scales = "free_y") +
  labs(title = "Horsepower Distribution Across Engine Size Groups",
       x = "Horsepower", 
       y = "Count",
       fill = "Engine Size Group")
```

> When horsepower is examined across the engine size groups, the
> distribution reveals that the majority of engines belong to the 91-190
> size range, which corresponds to mid-sized engines commonly found in
> everyday vehicles.These engines have a broad horsepower spread but
> remain mostly within standard performance levels.Smaller engines in
> the 60-90 group show notably lower horsepower values, reflecting their
> limited power output.Engines in the 191-299 group shift toward higher
> horsepower ranges but occur much less frequently, while engines in the
> 300+ group are extremely rare and represent high-performance or
> specialized models.
>
> =\> Clear relationship between engine size and horsepower, where
> larger engines tend to support higher power capacity.

############################################################### 

# Task 3

## 3.1 Do diesel cars have higher average CityMpg than gasoline cars?

```{r}
t_test_fuel <- t.test(CityMpg ~ FuelTypes, 
                      data = merge(automobile, engine, by = "EngineModel"))
t_test_fuel
```

To determine whether diesel vehicles have higher average CityMpg than
gasoline vehicles:

-\> The results show a statistically significant difference between the
two groups with:

-   t = 3.90

-   df = 22.6

-   p = 0.00074

-\> diesel: 30.30 MPG, gasoline: 24.28 MPG

-\> Diesel cars have significantly higher CityMpg than gasoline cars

-\> The 95% confidence interval (2.82 to 9.22 MPG) confirms that this
difference is meaningful

-\> Since diesel engines generally operate more eﬀiciently at lower
speeds and produce better fuel economy in city driving

***Note:** check whether two groups have different averages -\> t-test:
best choice*

## 3.2 How does DriveWheels affect fuel efficiency (CityMpg and HighwayMpg)?

```{r}
# Mean CityMpg by DriveWheels
city_means <- aggregate(CityMpg ~ DriveWheels, data = automobile, mean)
city_means

# One-way ANOVA for CityMpg
anova_city <- aov(CityMpg ~ DriveWheels, data = automobile)
summary (anova_city)

# Mean HighwayMpg by DriveWheels
highway_means <- aggregate(HighwayMpg ~ DriveWheels, data = automobile, mean)
highway_means

# One-way ANOVA for HighwayMpg
anova_highway <- aov(HighwayMpg ~ DriveWheels, data = automobile)
summary (anova_highway)
```

To examine whether DriveWheels affects fuel efficiency:

DriveWheels has a significant effect on both CityMpg and HighwayMpg

(p-value \< 2e-16 \< 0.001)

Besides,

-   FWD cars use the **least** fuel, giving them the highest MPG

-   4WD cars use the **most** fuel, resulting in the lowest MPG

-   RWD vehicles fall between the two

***Note**: DriveWheels strongly influences fuel economy, and ANOVA is
the correct test for comparing three or more groups*

## 3.3 Filtering engines with trouble and Identifying Top 5 Trouble Types

```{r}
# Filter trouble-related cases
trouble <- maintenance[maintenance$ErrorCodes != 0, ]

# List top 5 most common troubles
top5_troubles <- sort(table(trouble$Troubles), decreasing = TRUE)[1:5]
top5_troubles
```

Cylinders are the most common troubles (38)

Then Chasis (25), Ignition Issues (22), Noise-related Issues (19), and
Worn tires (16)

***Note**: Count how many times each category appears -\> frequency
table*

## 3.4 Association Between Engine Type and Trouble Type

```{r}
trouble$HasTrouble <- ifelse(trouble$Troubles == "none" | is.na(trouble$Troubles), 0, 1)

table_simple <- table(trouble$ErrorCodes, trouble$HasTrouble)
chisq.test(table_simple)
```

-   Chi-square test -\> there is significant association (p-value \<
    2.2e-16 \< 0.001)

-   Vehicles with ErrorCodes \# 0 -\> more likely to have trouble

-   ErrorCodes is a useful indicator of suspected issues

***Note**: two categorical variables are connected -\> Chi-square test*

############################################################### 

# Task 4

## 4.1 Which error type (ErrorCodes) occurs most frequently

```{r}
# Count frequency of each error type
error_counts <- table(maintenance$ErrorCodes)
error_counts
```

-   ErrorCode = 1 (confirmed trouble): most frequent

-   ErrorCode = –1 (suspected trouble): second

-   ErrorCode =0 (no trouble): least frequent

## 4.2 Analyze the factors that might influence the Maintenance Methods
```{r}
# Merge datasets and filter trouble cases
library(dplyr)

trouble_data <- merge(automobile, engine, by = "EngineModel") %>%
  merge(maintenance, by = "PlateNumber") %>%
  filter(ErrorCodes != 0)
```

```{r}
# FuelTypes vs Methods
table_Fuel_Methods <- table(trouble_data$FuelTypes, trouble_data$Methods)
table_Fuel_Methods

# Chi-squared test
chisq.test(table_Fuel_Methods)
```

```{r}
#BodyStyles vs Methods
table_Body_Methods <- table(trouble_data$BodyStyles, trouble_data$Methods)
table_Body_Methods

#Chi-squared test
chisq.test(table_Body_Methods)
```

